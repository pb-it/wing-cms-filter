function e(e,r){return r.startsWith("!")?!e.includes(parseInt(r.substring(1))):e.includes(parseInt(r))}const r=function(r,n){var i;if(n.indexOf(",")>=0){i=n.split(",").some((n=>e(r,n)))}else{var t,s=n.indexOf("("),a=n.lastIndexOf(")"),f=s>=0&&a>0;t=f?n.substring(s+1,a):n,i=function(r,n){var i;if(n.indexOf("&&")>=0){i=n.split("&&").every((n=>e(r,n)))}else if(n.indexOf("||")>=0){i=n.split("||").some((n=>e(r,n)))}else i=e(r,n);return i}(r,t),f&&n.startsWith("!")&&(i=!i)}return i};function n(e,r){for(var s,a,f=0,l=!1,o=!1,c=!1,u=!1,h=!1,g=-1,v=-1,b=0;b<r.length;b++){switch(r[b]){case"(":f++,-1==g&&(o=!0,g=b,b>0&&"!"==r[b-1]&&(l=!0));break;case")":if(!(f>0))throw new Error("invalid expression");f--;break;case".":-1==g&&b>0&&"@"==r[b-1]&&(c=!0,g=b-1,b>1&&"!"==r[b-2]&&(l=!0));break;case"&":if(0==f&&b>0&&"&"==r[b-1]){if(!(g>=0))throw new Error("invalid expression");u=!0,v=b-1}break;case"|":if(0==f&&b>0&&"|"==r[b-1]){if(!(g>=0))throw new Error("invalid expression");h=!0,v=b-1}}if(v>=0)break}if(0!=f)throw new Error("invalid expression");if(g>=0?(-1==v&&(v=r.length),c?a=r.substring(g,v):o&&(a=r.substring(g+1,v-1))):a=r,c)s=function(e,r){var n=[];if(!r.startsWith("@."))throw"invalid predicate";var s,a,f,l;if((r=r.substring(2)).indexOf("==")>=0)s="==";else if(r.indexOf("!=")>=0)s="!=";else if(r.indexOf("=~")>=0)s="=~";else if(r.indexOf(">=")>=0)s=">=";else if(r.indexOf("<=")>=0)s="<=";else{if(r.indexOf("=")>=0)throw new Error("invalid operator");r.indexOf(">")>=0?s=">":r.indexOf("<")>=0&&(s="<")}null==s?a=t(r):null!=(l=r.split(s))&&2==l.length&&(a=t(l[0]),f=l[1]);if(null!=a)for(var o,c=0;c<e.length;c++)i(o=e[c],a,s,f)&&n.push(o);return n}(e,a);else{if(!o)throw new Error("invalid expression");s=n(e,a)}return l&&(s=e.filter((e=>!s.includes(e)))),u?s=n(s,r.substring(v+2)):h&&(s=[...new Set([...s,...n(e,r.substring(v+2))])]),s}function i(e,n,t,s){var f=!1;if(e){var l=n[0],o=e[l.name];if(o)if(1==n.length)l.type==a.object&&(f=function(e,r,n){var i=!1;if(null!=r)if(null!=e){var t=n.split('"');switch(3!=t.length||t[0]||t[2]||(n=t[1]),r){case"==":case"!=":var s,a=new RegExp(',(?=(?:[^"]*"[^"]*")*[^"]*$)'),f=n.split(a);for(var l in f)(s=f[l]).startsWith('"')&&s.endsWith('"')&&(f[l]=s.substring(1,s.length-1));var o=f.includes(e.toString());i="=="==r?o:!o;break;case"=~":var c;(a=n).indexOf("/")>=0&&3==(t=a.split("/")).length&&""==t[0]&&(a=t[1],c=t[2]),i=new RegExp(a,c).test(e);break;case">=":i=e>=n;break;case"<=":i=e<=n;break;case">":i=e>n;break;case"<":i=e<n}}else"!="==r&&(i=!0);else i=null!=e;return i}(o,t,s));else{var c=n.slice(1);if(l.type==a.object)f=i(o,c,t,s);else if(l.type==a.array)if(2==n.length){var u=n[1].name;if("length()"==u){var h=o.length;switch(t){case"==":f=h==s;break;case"!=":f=h!=s;break;case"~=":break;case">=":f=h>=s;break;case"<=":f=h<=s;break;case">":f=h>s;break;case"<":f=h<s}}else if("=="==t||"!="==t){var g=r(Array.from(o,(e=>e[u])),s);"=="==t?f=g:"!="==t&&(f=!g)}}else for(var v=o,b=0;b<v.length&&!(f=i(v[b],c,t,s));b++);}else"!="==t&&(f=!0)}else"!="==t&&(f=!0);return f}function t(e){for(var r=[],n=e.split("."),i=0;i<n.length;i++)r.push(s(n[i]));return r}function s(e){return e.endsWith("[*]")?new f(e.substring(0,e.length-3),a.array):new f(e,a.object)}const a=Object.freeze({number:1,string:2,object:3,array:4});class f{constructor(e,r){this.name=e,this.type=r}}var l=function(e,r){return function(e,r){(r=function(e){var r=e.split('"');if(r.length%2==1)for(var n=0;n<r.length;n+=2)r[n]=r[n].replace(/\s/g,"");return r.join('"')}(r)).startsWith("$.");(r=function(e){var r,n=e.indexOf("["),i=e.lastIndexOf("]");if(!(n>=0&&i>0))throw new Error("incorrect clasping");r=e.substring(n+1,i);return r}(r)).startsWith("?");return r=function(e){var r,n=e.indexOf("("),i=e.lastIndexOf(")");if(!(n>=0&&i>0))throw new Error("incorrect clasping");r=e.substring(n+1,i);return r}(r),n(e,r)}(e,r)};export{l as default};
